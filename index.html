<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ルーレット</title>
    <style>
      body,
      html {
        height: 100vh;
        margin: 0;
        padding: 0;
        overflow: hidden;
        font-family: "Yu Gothic", "Meiryo", "sans-serif"; /* ゴシック体を指定 */
      }
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
        padding: 0;
        overflow: hidden;
        font-family: "Yu Gothic", "Meiryo", "sans-serif";
        background: #f7f7f7;
        background-image: url("background_img.jpg");
        background-size: auto 100vh;      /* 縦を画面いっぱいに */
        background-position: left center; /* 横は左寄せ */
        background-repeat: no-repeat;
      }
      #container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      #wheel-area {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      canvas {
        border-radius: 50%;
        box-sizing: border-box;
        display: block;
        background: #f49293;
        border: 12px solid #f49293;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        width: 80vw;
        max-width: 320px;
        height: 80vw;
        max-height: 320px;
      }
      #pointer {
        position: absolute;
        left: 50%;
        top: -60px; /* canvasの上に配置（大きくした分上に） */
        transform: translateX(-50%) rotate(180deg); /* 下向きに回転 */
        width: 50px;
        height: 170px;
        z-index: 2;
        pointer-events: none;
      }
      #stand {
        width: 100px;
        height: 60px;
        background: #f5e2b8;
        border-radius: 0 0 30px 30px;
        border: 8px solid #f5e2b8;
        margin-top: -18px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }
      #base {
        width: 200px;
        height: 25px;
        background: #f49293;
        border-radius: 8px;
        margin-top: -10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border: 4px solid #f49293;
      }
      button {
        margin-top: 28px;
        padding: 12px 40px;
        font-size: 1.4em;
        font-weight: bold;
        background: #eebc3a;
        color: #fff;
        border: none;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        cursor: pointer;
      }
      #modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }
      #modal-content {
        background: #fff;
        padding: 30px 20px;
        border-radius: 10px;
        text-align: center;
        min-width: 200px;
        font-size: 1.5em;
        border: 4px solid #f49293;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.18);
        font-family: "Yu Gothic", "Meiryo", "sans-serif"; /* ゴシック体を指定 */
      }
      @media (max-width: 429px) {
        #stand {
          width: 50vw;
          height: 12vw;
          min-height: 40px;
        }
        #base {
          width: 80vw;
          height: 7vw;
          min-height: 18px;
        }
        #wheel-area {
          width: 90vw;
          max-width: 98vw;
          height: 90vw;
          max-height: 98vw;
          position: relative;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        canvas {
          width: 90vw;
          height: 90vw;
          max-width: 98vw;
          max-height: 98vw;
          display: block;
        }
        #pointer {
          width: 50px;
          height: 60px;
          left: 50%;
          top: 0;
          transform: translateX(-50%) rotate(180deg);
          position: absolute;
          z-index: 2;
          pointer-events: none;
        }
      }
    </style>
  </head>
  <body>
    <div id="container">
      <div id="wheel-area">
        <canvas id="wheel"></canvas>
        <!-- ポインター（三角形のみ、円なし） -->
        <svg id="pointer" viewBox="0 0 100 100">
          <polygon
            points="50,10 90,80 10,80"
            fill="#fff"
            stroke="#fff"
            stroke-width="5"
          />
        </svg>
      </div>
      <div id="stand"></div>
      <div id="base"></div>
      <button id="spinBtn" onclick="spin()">START</button>
    </div>
    <!-- モーダル -->
    <div id="modal">
      <div id="modal-content">
        <p id="modal-text"></p>
      </div>
    </div>
    <script>
      const items = ["A賞", "B賞", "C賞", "D賞", "A賞", "B賞", "C賞", "D賞"];
      // 紫と水色で交互に
      const colors = [
        "#f5e2b8",
        "#a4c3bb",
        "#f5e2b8",
        "#a4c3bb",
        "#f5e2b8",
        "#a4c3bb",
        "#f5e2b8",
        "#a4c3bb",
      ];
      const canvas = document.getElementById("wheel");
      const ctx = canvas.getContext("2d");

      function resizeCanvas() {
        const size = Math.min(window.innerWidth * 0.8, 320);
        canvas.width = size;
        canvas.height = size;
      }
      resizeCanvas();
      window.addEventListener("resize", () => {
        resizeCanvas();
        drawWheel();
      });

      const radius = () => canvas.width / 2;
      let currentRotation = 0;

      function drawWheel() {
        const arc = (2 * Math.PI) / items.length;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 外枠（ゴールド）
        ctx.save();
        ctx.beginPath();
        ctx.arc(radius(), radius(), radius() - 6, 0, 2 * Math.PI);
        ctx.lineWidth = 12;
        ctx.strokeStyle = "#f49293";
        ctx.stroke();
        ctx.restore();

        // セグメント
        for (let i = 0; i < items.length; i++) {
          const angle = i * arc + currentRotation;
          ctx.beginPath();
          ctx.moveTo(radius(), radius());
          ctx.arc(radius(), radius(), radius() - 12, angle, angle + arc);
          ctx.closePath();
          ctx.fillStyle = colors[i % colors.length];
          ctx.fill();
          ctx.save();
          ctx.strokeStyle = "#fff";
          ctx.lineWidth = 2;
          ctx.stroke();
          ctx.restore();

          // テキスト
          ctx.save();
          ctx.translate(radius(), radius());
          ctx.rotate(angle + arc / 2);
          ctx.textAlign = "center";
          ctx.fillStyle = "#3E2723"; // さらに濃いこげ茶色
          ctx.font = `${Math.max(canvas.width / 16, 13)}px sans-serif`;
          ctx.fillText(items[i], radius() * 0.62, 8);
          ctx.restore();
        }

        // 中央円（ゴールド枠＋白）
        ctx.save();
        ctx.beginPath();
        ctx.arc(radius(), radius(), radius() * 0.22, 0, 2 * Math.PI);
        ctx.fillStyle = "#fff";
        ctx.fill();
        ctx.lineWidth = 6;
        ctx.strokeStyle = "#f49293";
        ctx.stroke();
        ctx.restore();
      }

      function showModal(text) {
        document.getElementById("modal-text").innerText = text;
        document.getElementById("modal").style.display = "flex";
      }

      function spin() {
        document.getElementById("spinBtn").remove();

        const spinAngle = Math.floor(Math.random() * 360) + 1800;
        const duration = 4000;
        const start = performance.now();

        function animate(time) {
          const elapsed = time - start;
          if (elapsed < duration) {
            const easeOut = 1 - Math.pow(1 - elapsed / duration, 3);
            currentRotation = (spinAngle * easeOut * Math.PI) / 180;
            drawWheel();
            requestAnimationFrame(animate);
          } else {
            currentRotation = (spinAngle * Math.PI) / 180;
            drawWheel();

            const arc = (2 * Math.PI) / items.length;
            const angle =
              (-Math.PI / 2 - currentRotation + 2 * Math.PI) % (2 * Math.PI);
            let index = Math.floor(angle / arc);
            if (index < 0) index += items.length;

            showModal(items[index]);
          }
        }
        requestAnimationFrame(animate);
      }

      drawWheel();
    </script>
  </body>
</html>
